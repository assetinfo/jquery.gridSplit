/*! 
* Author: Graham Dixon 
* Contact: gdixon@assetinfo.co.uk 
* Copyright: (c) 2015 Graham Dixon (assetinfo(MML))
* Script: jquery.gridsplit.min.js - v.0.0.1 
* Licensed: MIT 
* Depends on: jQuery && jQuery-ui-draggable, bootstrap 3.*
*/
!function(a){"function"==typeof define&&define.amd?define(["jquery","jqueryui-draggable"],a):a(jQuery,jQuery)}(function(a,b){a.fn.gridSplit=function(b){var d,e=function(e){void 0==a(e).data("grid")?(d=new c(e,b),a(e).data("grid",d)):d="undefined"!=typeof b?"undefined"!=typeof b.data?e.data("grid").init(e,b):"undefined"!=typeof b.setMeta?e.data("grid").setMeta(b.setMeta,!1):e.data("grid"):e.data("grid")};return e(this),d};var c=function(b,c){var d=this,e={horizRail:a("<div/>").addClass("horizrail"),vertRail:a("<div/>").addClass("vertrail"),gridColClass:"column",gridCellClass:"gridCell",innerGridClass:"inner-grid",insideCellClass:"insideCell",hasChildrenClass:"hasChildren",hasContentClass:"hasContent h100per",resizableClass:"isResizable",draggingClass:"dragging",data:"",parentGrid:"",nestedIn:"",resizable:!0,splitMethodH:"",splitMethodV:"half",horizMin:13,vertMin:10,callFocusAndLoad:null,callResetGrid:null,callAfterMove:null,callFinaliseMove:null,callSetFocus:null,callBeforeDestroy:null,hideBorder:{border:"0px solid #000"}};d.init=function(b,c){return this.settings={},this.settings=a.extend({},e,c),this.id=b.attr("id"),this.$el=a("#"+this.id),this.el=this.$el[0],this.gridsColumns=[],this.gridsCells=[],this.gridsStructure=[],this.timeoutFPH=[],this.metaAt={},a("#"+this.id+" ."+this.settings.innerGridClass).remove(),this.elInner=a("<div />").addClass(this.settings.innerGridClass).appendTo(this.$el),1==this.settings.splitCellInColumn&&(this.settings.useInsideCell=this.settings.insideCellClass+""+this.settings.nestedIn),""==this.settings.data?(this.gridsStructure[0]="null",this.addColumn(0),this.gridsStructure[0][0]="null",this.addCell(0,0),1==this.settings.splitCellInColumn&&this.addColumn(0)):this.buildGrid(this.settings.data),this},d.buildGrid=function(b,c){function d(a){var b=0;return"object"==typeof a[0][0]&&"100%"==a[0][0].h&&"100%"==a[0].c.w&&"undefined"!=typeof a[1]&&delete a[1],1==e.countCells(a)&&1==e.countCells(a[0][0])&&1==e.countCells(a[0])&&(b=a[0][0]),0==b?a:d(b)}var e=this;return e.buildingGrid=!0,b=d(b),a.each(b,function(b,d){isNaN(b)||(e.gridsStructure[b]="null",e.addColumn(b,c,!0),e.gridsColumns[b].css("float","left"),e.countCells(d)>0?a.each(d,function(a,c){if(!isNaN(a)&&(e.addCell(b,a),"object"==typeof c[0])){e.gridsCells[b][a].addClass(e.settings.hasChildrenClass);{e.splitCellInColumn(e.gridsCells[b][a],b,a,c)}}}):e.addCell(b,0))}),e.setMeta(b),e==e.parent()&&"function"==typeof e.settings.callResetGrid&&e.settings.callResetGrid(),e},d.setMeta=function(b){var c=this;return a.each(b,function(b,d){if(!isNaN(b)){if("undefined"!=typeof d.c){var e=d.c.w;c.gridsColumns[b].css("width",e),c.resizeColumn(b,e)}c.countCells(d)>0&&a.each(d,function(a,d){"object"==typeof d[0]?"undefined"!=typeof c.gridsCells[b][a]&&"undefined"!=typeof c.gridsCells[b][a].data("grid")&&(c.gridsCells[b][a].data("grid").setMeta(d),c.gridsCells[b][a].css("height",d.h),c.resizeCell(b,a,d.h)):"undefined"!=typeof d.fA&&(d.isFullScreen===!0&&(c.metaAt[b][a].isFullScreen=!0),"undefined"!=typeof d.fSID&&(c.metaAt[b][a].fSID=d.fSID),"undefined"!=typeof c.gridsCells[b][a]&&(c.gridsCells[b][a].css("height",d.h),c.resizeCell(b,a,d.h)),"function"==typeof c.settings.callFocusAndLoad&&c.settings.callFocusAndLoad(c,b,a,d.fA,c.metaAt[b][a].isFullScreen))})}c.forcePerHeight(b)}),c.buildingGrid=!1,this},d.countCells=function(b){var c=0;return a.each(b,function(a,b){isNaN(a)||c++}),c},d.addCell=function(c,d,e){var f=this;if("undefined"==typeof c||"undefined"==typeof d)return this;if(this.gridsStructure.length-1<c&&(c=this.gridsStructure.length-1),"null"==this.gridsStructure[c][d]){if(b=a('<div class="'+this.settings.gridCellClass+" "+(1==this.settings.splitCellInColumn?this.settings.insideCellClass+" "+this.settings.useInsideCell:"")+'" ></div>'),"undefined"!=typeof e?b.insertAfter(e):b.appendTo(this.gridsColumns[c]),this.gridsStructure[c][d]=!0,this.gridsCells[c][d]=b,"undefined"==typeof this.metaAt[c][d]&&(this.metaAt[c][d]={}),b.data("gridAt",this),b.data("cell",'{"x":'+parseInt(c)+',"y":'+parseInt(d)+"}"),this.addControls(this.gridsCells[c][d],c,d),f!==f.parent()){var g=JSON.parse(f.$el.data("cell")),h=f.parent().metaAt[g.x][g.y].h;f.parent().metaAt[g.x][g.y]=f.metaAt,f.parent().metaAt[g.x][g.y].h=h,f.parent().gridsStructure[g.x][g.y]=f.gridsStructure}}else this.gridsStructure[c].length>d?this.splitAt(c,d):(c<this.gridsStructure.length-1?this.splitAt(this.gridsStructure.length,d):this.splitAt(c,this.gridsStructure[c].length-1),delete this.gridsStructure[c][d]);return this},d.addColumn=function(b,c,d){var e=this;if("undefined"!=typeof b){if("null"==this.gridsStructure[b]){var f=a('<div class="'+this.settings.gridColClass+'" ></div>');if("undefined"!=typeof c?f.insertAfter(c):f.appendTo(this.elInner),this.gridsStructure[b]=[],this.gridsCells[b]=[],this.metaAt[b]={},this.gridsColumns[b]=f.data("tpe","c"),this.addControls(this.gridsColumns[b],b),e!==e.parent()){var g=JSON.parse(e.$el.data("cell")),h=e.parent().metaAt[g.x][g.y].h;e.parent().metaAt[g.x][g.y]=e.metaAt,e.parent().metaAt[g.x][g.y].h=h,e.parent().gridsStructure[g.x][g.y]=e.gridsStructure}}else this.gridsStructure.length>b?this.splitAt(b):(this.splitAt(this.gridsStructure.length-1),delete this.gridsStructure[b]);return 1==!d&&(clearTimeout(e.timeoutFP),e.timeoutFP=setTimeout(function(){e.forcePerWidth()})),this}},d.splitAt=function(b,c,d){var e=this;if("undefined"!=typeof c){if("undefined"!=typeof d)return e.gridsCells[b][c].addClass(e.settings.hasChildrenClass),e.splitCellInColumn(e.gridsCells[b][c],b,c);if(c+1==e.gridsStructure[b].length)e.gridsStructure[b][c+1]="null",e.addCell(b,c+1);else{var f=[],g={},h=[];g.c=e.metaAt[b].c,a.each(e.gridsCells[b],function(a,d){a>=c+1?(f[a+1]=e.gridsCells[b][a],g[a+1]=e.metaAt[b][a],h[a+1]=e.gridsStructure[b][a],f[a+1].data("cell",'{"x":'+parseInt(b)+',"y":'+parseInt(a+1)+"}"),"function"==typeof e.settings.callAfterMove&&e.settings.callAfterMove(e.id+""+b+a,e.id+""+b+(a+1),e,b,a+1)):(f[a]=e.gridsCells[b][a],g[a]=e.metaAt[b][a],h[a]=e.gridsStructure[b][a])}),e.gridsCells[b]=f,e.metaAt[b]=g,e.gridsStructure[b]=h,e.gridsStructure[b][c+1]="null",e.addCell(b,c+1,e.gridsCells[b][c]),"function"==typeof e.settings.callFinaliseMove&&e.settings.callFinaliseMove()}{var i=e.gridsCells[b][c],j=e.gridsCells[b][c+1];e.gridsCells[b].length}if("undefined"!=typeof i&&e.buildingGrid!==!0&&"half"==e.settings.splitMethodH){var k=i.outerHeight(),l=e.halfOf(i,j,k,"h");e.resizeCell(b,c,l),e.resizeCell(b,c+1,l),clearTimeout(e.timeoutFPH[b]),e.timeoutFPH[b]=setTimeout(function(){e.forcePerHeight(b)})}else{var l=this.halfOf(i,j,0,"h",e.gridsCells[b]);a.each(this.gridsCells[b],function(a,c){e.resizeCell(b,a,l)})}}else{if(b+1==e.gridsStructure.length)e.gridsStructure[b+1]="null",e.addColumn(b+1);else{var f=[],g={},m=[],h=[];a.each(e.gridsColumns,function(a,d){if(a>=b+1)for(f[a+1]=e.gridsColumns[a],g[a+1]=e.metaAt[a],m[a+1]=e.gridsCells[a],h[a+1]=e.gridsStructure[a],c=0;c<m[a+1].length;c++)m[a+1][c].data("cell",'{"x":'+parseInt(a+1)+',"y":'+parseInt(c)+"}"),"function"==typeof e.settings.callAfterMove&&e.settings.callAfterMove(e.id+""+a+c,e.id+""+(a+1)+c,e,a+1,c);else f[a]=e.gridsColumns[a],g[a]=e.metaAt[a],m[a]=e.gridsCells[a],h[a]=e.gridsStructure[a]}),e.gridsColumns=f,e.metaAt=g,e.gridsCells=m,e.gridsStructure=h,e.gridsStructure[b+1]="null",e.addColumn(b+1,e.gridsColumns[b]),"function"==typeof e.settings.callFinaliseMove&&e.settings.callFinaliseMove()}var i=e.gridsColumns[b],j=e.gridsColumns[b+1],n=e.gridsColumns[b].width();if("half"==e.settings.splitMethodV)var o=e.halfOf(i,j,n,"w");else var o=e.halfOf(i,j,n,"w",e);e.resizeColumn(b,o),e.resizeColumn(b+1,o),e.gridsStructure[b+1][0]="null",e.addCell(b+1,0)}return e},d.splitCellInColumn=function(a,b,c,d){var e=this.returnContent(a);if("undefined"!=typeof this.metaAt[b][c])var f=this.metaAt[b][c].h,g=this.metaAt[b][c].fA;return a.attr("id",(""!==this.settings.nestedIn?this.settings.nestedIn+"-"+this.id:this.id)+"-"+b+c).css(this.settings.hideBorder).off("click").gridSplit({parentGrid:this,parentsX:b,parentsY:c,splitCellInColumn:!0,callFocusAndLoad:this.settings.callFocusAndLoad,callResetGrid:null,callAfterMove:this.settings.callAfterMove,callFinaliseMove:this.settings.callFinaliseMove,callSetFocus:this.settings.callSetFocus,callBeforeDestroy:this.settings.callBeforeDestroy,nestedIn:""!==this.settings.nestedIn?this.settings.nestedIn+"-"+this.id:this.id,data:"undefined"!=typeof d?d:"",resizable:this.settings.resizable}),this.gridsStructure[b][c]={},this.gridsStructure[b][c]=a.data("grid").gridsStructure,"undefined"==typeof this.metaAt[b]&&(this.metaAt[b]={},this.metaAt[b].c={}),"undefined"!=typeof e&&a.data("grid").gridsCells[0][0].addClass(this.settings.hasContentClass).append(e),this.metaAt[b][c]=a.data("grid").metaAt,this.metaAt[b][c].h=f,a.data("grid").setMetaAt(0,0,{fA:g,h:"100%"}),a.data("grid")},d.delCell=function(b,c){var d=this,e=[],f={},g=[];if("undefined"!=typeof d.gridsColumns[b]&&"undefined"!=typeof d.gridsCells[b][c])if(d.gridsColumns.length>0)if(d.gridsCells[b].length>1){var h=d.gridsCells[b][c];if(a("#h1-"+h.data("widgetID")).remove(),a("#h2-"+h.data("widgetID")).remove(),a(window).off("resize.grid."+a(this.gridsCells[b][c]).data("widgetID")),f.c=d.metaAt[b].c,a.each(this.gridsCells[b],function(h,i){h>c?(e[h-1]=d.gridsCells[b][h],f[h-1]=d.metaAt[b][h],g[h-1]=d.gridsStructure[b][h],e[h-1].data("cell",'{"x":'+parseInt(b)+',"y":'+parseInt(h-1)+"}"),"function"==typeof d.settings.callAfterMove&&d.settings.callAfterMove(d.id+""+b+h,d.id+""+b+(h-1),d,b,h-1),"undefined"!=typeof e[h-1]?a(window).trigger("resize.grid."+a(e[h-1]).data("widgetID")):d.delCell(b,h-1)):h!=c?(e[h]=d.gridsCells[b][h],f[h]=d.metaAt[b][h],g[h]=d.gridsStructure[b][h]):h-1>=0&&(d.resizeCell(b,h,d.gridsCells[b][h].height()+d.gridsCells[b][h-1].height()),d.gridsCells[b][h-1].height(d.gridsCells[b][h].height()+d.gridsCells[b][h-1].height()))}),d.gridsCells[b]=e,d.metaAt[b]=f,d.gridsStructure[b]=g,d.forcePerHeight(b),d!==d.parent()){var i=JSON.parse(d.$el.data("cell")),j=d.parent().metaAt[i.x][i.y].h;d.parent().metaAt[i.x][i.y]=d.metaAt,d.parent().metaAt[i.x][i.y].h=j,d.parent().gridsStructure[i.x][i.y]=d.gridsStructure}"function"==typeof d.settings.callFinaliseMove&&d.settings.callFinaliseMove(),a(h).remove()}else d.delColumn(b);else d.delColumn(b);return d},d.delColumn=function(b){var c=this,d=[],e={},f=[],g=[],h=c.gridsColumns[b];if("undefined"!=typeof c.gridsColumns[b]){if(a.each(c.gridsColumns,function(h,i){if(h>b){for(d[h-1]=c.gridsCells[h],e[h-1]=c.metaAt[h],f[h-1]=c.gridsStructure[h],g[h-1]=c.gridsColumns[h],y=0;y<d[h-1].length;y++)"undefined"!=typeof d[h-1][y]&&(d[h-1][y].data("cell",'{"x":'+parseInt(h-1)+',"y":'+parseInt(y)+"}"),"function"==typeof c.settings.callAfterMove&&c.settings.callAfterMove(c.id+""+h+y,c.id+""+(h-1)+y,c,h-1,y));"undefined"!=typeof d[h-1]?a(window).trigger("resize.grid."+a(d[h-1]).data("widgetID")):c.delColumn(h-1)}else if(h!=b){if(d[h]=c.gridsCells[h],e[h]=c.metaAt[h],f[h]=c.gridsStructure[h],g[h]=c.gridsColumns[h],"function"==typeof c.settings.callAfterMove)for(y=0;y<d[h].length;y++)c.settings.callAfterMove(c.id+""+h+y,c.id+""+h+y,c,h,y)}else h-1>=0&&(c.resizeColumn(h-1,c.gridsColumns[h].outerWidth()+c.gridsColumns[h-1].outerWidth()),c.gridsColumns[h-1].outerWidth(c.gridsColumns[h].outerWidth()+c.gridsColumns[h-1].outerWidth()))}),a(h).remove(),c.gridsCells=d,c.metaAt=e,c.gridsStructure=f,c.gridsColumns=g,c!==c.parent()){var i=JSON.parse(c.$el.data("cell")),j=c.parent().metaAt[i.x][i.y].h;c.parent().metaAt[i.x][i.y]=c.metaAt,c.parent().metaAt[i.x][i.y].h=j,c.parent().gridsStructure[i.x][i.y]=c.gridsStructure,c.parent().forcePerHeight(i.x)}if(0==d.length&&"undefined"!=typeof c.$el.data("cell")){var i=JSON.parse(c.$el.data("cell"));isNaN(i.x)||isNaN(i.y)||"undefined"!=typeof c.parent().gridsCells[i.x]&&"undefined"!=typeof c.parent().gridsCells[i.x][i.y]&&c.parent().delAt(i.x,i.y)}"function"==typeof c.settings.callFinaliseMove&&c.settings.callFinaliseMove(),c.forcePerWidth()}return c},d.delAt=function(a,b){return"undefined"==typeof b||null==b?this.delColumn(a):this.delCell(a,b)},d.addRail=function(b,c,d){var e=this;if(1==this.settings.resizable&&b.addClass(this.settings.resizableClass),"c"==a(b).data("tpe")){if(0!==c){var f=(this.settings.gridColClass,this.settings.vertRail),g=f.clone();g.appendTo(b),g.on("mouseenter",function(){var b=a(this).closest("."+e.settings.gridColClass).prevAll("."+e.settings.gridColClass).length;("undefined"==typeof e.gridsColumns[b]||0==b)&&g.remove()}).draggable({axis:"x",containment:b.parent(),start:function(b,c){var d=a(this).closest("."+e.settings.gridColClass).prevAll("."+e.settings.gridColClass).length;if("function"==typeof e.settings.callSetFocus&&e.settings.callSetFocus(JSON.parse(a(e.gridsCells[d-1][0]).data("cell")),e),"undefined"!=typeof e.gridsColumns[d]&&0!==d){g.data("x",d);{e.gridsColumns[d-1]}g.origRight=e.gridsColumns[d].offset().left-e.$el.offset().left,g.origLeft=e.gridsColumns[d-1].offset().left-e.$el.offset().left,g.origWidth=g.origRight-g.origLeft,a(this).addClass(e.settings.draggingClass)}else g.remove()},stop:function(){var b=a(this).offset().left,d=b-g.origWidth-e.$el.offset().left,f=d+g.origWidth-g.origLeft,h=e.perOfWidth(f);e.gridsColumns[a(this).data("x")-1].css("width",h);var i=e.gridsColumns.length-a(this).data("x"),j=(f-g.origWidth)/i;if(i>0){for(c=a(this).data("x");c<e.gridsColumns.length;c++){var k=e.gridsColumns[c].outerWidth(),l=k-j;e.gridsColumns[c].css("width",e.perOfWidth(l))}e.forcePerWidth()}a(this).css("left","auto"),"function"==typeof e.settings.callSetHash&&e.settings.callSetHash()}})}}else if(0!==d){var f=(this.settings.gridCellClass,this.settings.horizRail),g=f.clone();g.appendTo(b);var e=this;g.on("mouseenter",function(){var b=a(this).closest("."+e.settings.gridCellClass).prevAll("."+e.settings.gridCellClass).length,c=a(this).closest("."+e.settings.gridColClass).prevAll("."+e.settings.gridColClass).length;("undefined"==typeof e.gridsCells[c][b]||0==b)&&g.remove()}).draggable({containment:b.parent(),axis:"y",start:function(b,c){var d=a(this).closest("."+e.settings.gridCellClass).prevAll("."+e.settings.gridCellClass).length,f=a(this).closest("."+e.settings.gridColClass).prevAll("."+e.settings.gridColClass).length;"function"==typeof e.settings.callSetFocus&&e.settings.callSetFocus(JSON.parse(a(e.gridsCells[f][d-1]).data("cell")),e),"undefined"!=typeof e.gridsCells[f][d]&&0!==d?(g.data("x",f),g.data("y",d),a(this).addClass(e.settings.draggingClass)):g.remove()},stop:function(b,c){var d=c.position.top-c.originalPosition.top,f=a(this).data("y"),g=a(this).data("x"),h=(a(this).offset().top,e.gridsCells[g][f-1].outerHeight()+d),i=e.gridsColumns[g].outerHeight(),j=e.perOfHeight(h,i);e.gridsCells[g][f-1].css("height",j),h=e.gridsCells[g][f].outerHeight()-d,j=e.perOfHeight(h,i),e.gridsCells[g][f].css("height",j),a(this).css("top","auto"),e.forcePerHeight(g),"function"==typeof e.settings.callSetHash&&e.settings.callSetHash()}})}},d.resizeColumn=function(a,b){"undefined"==typeof this.metaAt&&(this.metaAt={}),"undefined"==typeof this.metaAt[a]&&(this.metaAt[a]={},this.metaAt[a].c={});var c={w:b};this.setMetaAt(a,null,c);var d=parseInt((this.$el.outerWidth()/100*parseInt(b)).toFixed(0));this.gridsColumns[a].data("trueWidth",d)},d.resizeCell=function(a,b,c){"undefined"==typeof this.metaAt[a]&&(this.metaAt[a]={},this.metaAt[a].c={}),"undefined"==typeof this.metaAt[a][b]&&(this.metaAt[a][b]={});var d={h:c};this.setMetaAt(a,b,d);var e=parseInt((this.gridsColumns[a].height()/100*parseInt(c)).toFixed(0)),f=this.gridsCells[a][b];f.data("trueHeight",e),f.find(".status").length>0&&(f.height()+f.offset().top<f.find(".status").offset().top+f.find(".status").height()-3?f.find(".status").css("opacity","0"):f.find(".status").css("opacity","1"))},d.setMetaAt=function(b,c,d){"undefined"==typeof this.metaAt[b]&&(this.metaAt[b]={},this.metaAt[b].c={}),null===c?this.metaAt[b].c=a.extend({},this.metaAt[b].c,d):("undefined"==typeof this.metaAt[b][c]&&(this.metaAt[b][c]={}),this.metaAt[b][c]=a.extend({},this.metaAt[b][c],d)),a(window).trigger("resize.grid")},d.addControls=function(b,c,d){var e=this;if("c"==a(b).data("tpe")){var f=(this.settings.gridColClass,"c");0!==c&&1==this.settings.resizable&&this.addRail(b,c,d)}else{var f=(this.settings.gridCellClass,"r");0!==d&&1==this.settings.resizable&&this.addRail(b,c,d)}b.on("click",function(){e.clickThis(this,f,a(b).data("gridAt"))})},d.clickThis=function(b,c,d){if("c"!==c){{this.gridCell}"function"==typeof d.settings.callSetFocus&&d.settings.callSetFocus(JSON.parse(a(b).data("cell")),d)}},d.halfOf=function(b,c,d,e,f){if("w"==e)if("undefined"!=typeof f)var g=this.perOfWidthEls(f);else{var g=this.perOfWidth(d/2);a(b).css({width:g,"float":"left"}),a(c).css({width:g,"float":"left"})}else if("h"==e)if("undefined"!=typeof f)var g=this.perOfHeightEls(f);else{var g=this.perOfHeight(d/2);a(b).css({height:g}),a(c).css({height:g})}return g},d.perOfWidth=function(a){var b=100/this.$el.width()*a;return b+"%"},d.perOfWidthEls=function(a){var b=a.$el.find("."+a.settings.innerGridClass).first().children("."+a.settings.gridColClass),c=b.length,d=100/c;return b.css({width:d+"%","float":"left"}),d},d.perOfHeight=function(a,b){var c=100/("undefined"!=typeof b?b:this.$el.outerHeight())*a;return c+"%"},d.perOfHeightEls=function(b){var c,d=b.length,e=100/d+"%";if(1==this.settings.splitCellInColumn)c="."+this.settings.useInsideCell;else{var f=":not(.",g=")";c="."+this.settings.gridCellClass+f+this.settings.insideCellClass+g}return a(b[0]).parent().find(c).css("height",e),e},d.equalPers=function(a,b,c){for(var e=a.length,f=0,g=0;e--;)g=0==c?this.settings.vertMin:this.settings.horizMin,a[e]<g&&(a[e]=g),f+=a[e];for(x=0;x<a.length;x++)a[x]=b/f*a[x];return a=d.percentageRounding(a,b)},d.percentageRounding=function(a,b){function c(a,b){return Math.abs(a-b)/a}for(var d,e,f,g,h=a.length,i=0,j=0,k=[],l=a.length,m=[];h--;)j+=k[h]=Math.round(a[h]);for(d=b>j?1:-1;j!==b;){for(h=0;l>h;h++)e=h===l-1?0:h+1,g=c(a[e],k[e]+d),f=c(a[h],k[h]+d),f>g&&(i=e);k[i]+=d,j+=d}for(h=0;l>h;h++)m[h]=k[h]&&Math.abs(a[h]-k[h])/a[h];for(h=0;l>h;h++)for(i=0;l>i;i++)if(i!==h){var n=c(a[h],k[h]+1)+c(a[i],k[i]-1),o=c(a[h],k[h]-1)+c(a[i],k[i]+1),p=m[h]+m[i];p>n&&(k[h]=k[h]+1,k[i]=k[i]-1,m[h]=k[h]&&Math.abs(a[h]-k[h])/a[h],m[i]=k[i]&&Math.abs(a[i]-k[i])/a[i]),p>o&&(k[h]=k[h]-1,k[i]=k[i]+1,m[h]=k[h]&&Math.abs(a[h]-k[h])/a[h],m[i]=k[i]&&Math.abs(a[i]-k[i])/a[i])}return k},d.centerInner=function(b){var c="undefined"!=typeof b?b:this;setTimeout(function(){var b=0;c.elInner.children("."+c.settings.gridColClass).each(function(){b+=a(this).outerWidth(!0)}),b<c.elInner.width()&&c.elInner.css("padding-left",(c.elInner.width()-b)/2+"px")})},d.forcePerWidth=function(){var b=[],c=this;a.each(this.gridsColumns,function(d,e){b.push(parseInt(c.perOfWidth(a(e).outerWidth())))});var d=this.equalPers(b,100,0);a.each(this.gridsColumns,function(b,e){a(e).css({width:d[b]+"%"}),c.resizeColumn(b,d[b]+"%")})},d.forcePerHeight=function(b){var c=[],d=this,e=this.gridsColumns[b];if("undefined"!=typeof e){a.each(d.gridsCells[b],function(b,f){c.push(parseInt(d.perOfHeight(a(f).outerHeight(),a(e).outerHeight())))});var f=d.equalPers(c,100,1);a.each(d.gridsCells[b],function(c,e){a(e).css({height:f[c]+"%"}),d.resizeCell(b,c,f[c]+"%")})}},d.returnContent=function(b){var c=b.children();if(1==c.length){if(0==c.hasClass("horizrail"))var d=c.detach()}else if(2==c.length)if(0==a(c[0]).hasClass("horizrail"))var d=a(c[0]).detach();else var d=a(c[1]).detach();return d},d.returnStructure=function(){return JSON.stringify(this.gridsStructure)},d.returnMeta=function(){return JSON.stringify(this.metaAt)},d.returnCells=function(){return this.gridsCells},d.parent=function(){return""===this.settings.parentGrid?this:this.settings.parentGrid},d.destroy=function(a){return"function"==typeof this.settings.callBeforeDestroy&&this.settings.callBeforeDestroy(this),this.$el.empty().removeData("grid"),this.$el},d.init(b,c)}});