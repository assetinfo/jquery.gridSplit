/*! 
* Author: Graham Dixon 
* Contact: gdixon@assetinfo.co.uk 
* Copyright: (c) 2015 Graham Dixon (assetinfo(MML))
* Script: jquery.gridsplit.min.js - v.0.0.1 
* Licensed: MIT 
* Depends on: jQuery && jQuery-ui-draggable
*/
!function(a){"function"==typeof define&&define.amd?define(["jquery","jqueryui-draggable"],a):a(jQuery,jQuery)}(function(a,b){a.fn.gridSplit=function(b){var d;return a(this).length&&(void 0==a(this).data("grid")?(d=new c(this,b),a(this).data("grid",d)):d=void 0!==b?void 0!==b.data?this.data("grid").init(this,b):void 0!==b.setMeta?this.data("grid").setMeta(b.setMeta,!1):this.data("grid"):this.data("grid")),d};var c=function(b,c){var d=this,e={horizRail:a("<div/>").addClass("rail horizrail"),vertRail:a("<div/>").addClass("rail vertrail"),gridColumnClass:"gridColumn",gridCellClass:"gridCell",innerGridClass:"innerGrid",insideCellClass:"insideCell",hasChildrenClass:"hasChildren",hasContentClass:"hasContent",resizableClass:"isResizable",draggingClass:"dragging",resizable:!0,data:"",nestedIn:"",parentsGrid:"",splitMethodH:"",splitMethodV:"half",horizMin:4,vertMin:4,callFocusLoad:null,callResetGrid:null,callAfterMove:null,callSetFocus:null,callBeforeDestroy:null,callAfterResize:null,callFinaliseMove:null,useContent:!1,hideBorder:{border:"0px"}};d.init=function(b,c){var d=this;return this.settings={},this.settings=a.extend({},e,c),this.id=b.attr("id"),this.$el=a("#"+this.id),this.el=this.$el[0],this.gridsColumns=[],this.gridsCells=[],this.gridsStructure=[],this.metaAt={},this.settings.useContent===!0&&(this.missingWHs=!1,this.settings.data=d.constructData(d.$el,{}),this.settings.backupCells=d.detachContent(d.$el,{})),this===this.parent()&&this.$el.empty(),1==this.settings.splitCellInColumn&&(this.settings.useInsideCell=this.settings.insideCellClass+""+this.settings.nestedIn),this.elInner=a("<div />").addClass(this.settings.innerGridClass).appendTo(this.$el),""==this.settings.data?(this.gridsStructure[0]=null,this.addColumn(0),this.gridsStructure[0][0]=null,this.addCell(0,0),1==this.settings.splitCellInColumn&&this.addColumn(0)):(this.buildGrid(this.settings.data),this.reattachContent(this.settings.backupCells),this.forcePerWidth(),a.each(this.settings.data,function(a,b){isNaN(a)||d.forcePerHeight(a)})),this.elInner.show(),this},d.buildGrid=function(b,c){var d=this;return d.elInner.show(),d.buildingGrid=!0,a.each(b,function(b,c){isNaN(b)||(d.gridsStructure[b]=null,d.addColumn(b),d.gridsColumns[b].css("float","left"),d.countKeys(c)>0?a.each(c,function(a,c){if(!isNaN(a)&&(d.addCell(b,a),"object"==typeof c[0])){d.gridsCells[b][a].addClass(d.settings.hasChildrenClass);d.splitCellInColumn(d.gridsCells[b][a],b,a,c)}}):d.addCell(b,0))}),d.setMeta(b),d==d.parent()&&"function"==typeof d.settings.callResetGrid&&d.settings.callResetGrid(),d},d.setMeta=function(b){var c=this;return a.each(b,function(b,d){if(!isNaN(b)){if(void 0!==d.c){var e=d.c.w;c.gridsColumns[b].css("width",e),c.resizeColumn(b,e)}c.countKeys(d)>0&&a.each(d,function(a,d){"object"==typeof d[0]?void 0!==c.gridsCells[b][a]&&void 0!==c.gridsCells[b][a].data("grid")&&(c.gridsCells[b][a].data("grid").setMeta(d),c.resizeCell(b,a,d.h),c.gridsCells[b][a].css("height",d.h)):(void 0!==c.gridsCells[b][a]&&(c.metaAt[b][a]=d,c.gridsCells[b][a].css("height",d.h),c.resizeCell(b,a,d.h)),"function"==typeof c.settings.callFocusLoad&&c.settings.callFocusLoad(c,b,a))})}}),c.buildingGrid=!1,this},d.constructData=function(b,c){var d=this,e=0;return a("div."+d.settings.gridColumnClass+" ",b).first().parent().children().each(function(){var b=0,f=a(this).attr("gs-width");void 0===f&&(d.missingWHs=!0),c[e]={c:{w:f}},a("div."+d.settings.gridCellClass+" ",a(this)).first().parent().children().each(function(){var f=a(this).attr("gs-height");void 0===f&&(d.missingWHs=!0),c[e][b]={},c[e][b].h=f,c[e][b]=d.constructData(a(this),c[e][b]),b++}),e++}),c},d.detachContent=function(b,c){var d=this,e=0;return a("."+d.settings.gridColumnClass,b).first().parent().children().each(function(){var b=0;c[e]={},a("."+d.settings.gridCellClass,a(this)).first().parent().children().each(function(){c[e][b]={},a("."+d.settings.gridColumnClass,a(this)).first().parent().children().length>0?c[e][b]=d.detachContent(this,c[e][b]):c[e][b].content=a(this).children().first().detach(),b++}),e++}),c},d.reattachContent=function(b){var c=this;return void 0!==b&&(a.each(b,function(b,d){isNaN(b)||c.countKeys(d)>0&&a.each(d,function(a,d){"object"==typeof d[0]?void 0!==c.gridsCells[b][a]&&void 0!==c.gridsCells[b][a].data("grid")&&c.gridsCells[b][a].addClass(c.settings.hasContentClass).data("grid").reattachContent(d):void 0!==c.gridsCells[b][a]&&c.gridsCells[b][a].addClass(c.settings.hasContentClass).append(d.content)})}),c.buildingGrid=!1),this},d.addCell=function(c,d){var e,f=this;if(void 0===c||void 0===d)return this;if(this.gridsStructure.length-1<c&&(c=this.gridsStructure.length-1),null==this.gridsStructure[c][d]){if(e=this.gridsStructure[c].length!==d&&void 0!==this.gridsCells[c][d-1]?this.gridsCells[c][d-1]:this.gridsColumns[c],b=a('<div class="'+this.settings.gridCellClass+" "+(1==this.settings.splitCellInColumn?this.settings.insideCellClass+" "+this.settings.useInsideCell:"")+'" ></div>'),e==this.gridsColumns[c]?b.appendTo(e):b.insertAfter(e),this.gridsStructure[c][d]=!0,this.gridsCells[c][d]=b,void 0===this.metaAt[c][d]&&(this.metaAt[c][d]={}),b.data("gridAt",this),b.data("cell",'{"x":'+parseInt(c)+',"y":'+parseInt(d)+"}"),this.addControls(c,d),f!==f.parent()){var g=JSON.parse(f.$el.data("cell")),h=f.parent().metaAt[g.x][g.y].h;f.parent().metaAt[g.x][g.y]=f.metaAt,f.parent().metaAt[g.x][g.y].h=h,f.parent().gridsStructure[g.x][g.y]=f.gridsStructure}}else this.gridsStructure[c].length>d?this.splitAt(c,d):(c<this.gridsStructure.length-1?this.splitAt(this.gridsStructure.length,d):this.splitAt(c,this.gridsStructure[c].length-1),delete this.gridsStructure[c][d]);return this},d.addColumn=function(b){var c=this;if(void 0!==b){if(null==this.gridsStructure[b]){this.gridsStructure.length!==b&&void 0!==this.gridsColumns[b-1]?place=this.gridsColumns[b-1]:place=this.elInner;var d=a('<div class="'+this.settings.gridColumnClass+'" ></div>');if(place==this.elInner?d.appendTo(place):d.insertAfter(place),this.gridsStructure[b]=[],this.gridsCells[b]=[],this.metaAt[b]={},this.gridsColumns[b]=d.data("type","column"),this.addControls(b),c!==c.parent()){var e=JSON.parse(c.$el.data("cell")),f=c.parent().metaAt[e.x][e.y].h;c.parent().metaAt[e.x][e.y]=c.metaAt,c.parent().metaAt[e.x][e.y].h=f,c.parent().gridsStructure[e.x][e.y]=c.gridsStructure}else c.metaAt[b].c={},c.metaAt[b].c.w="100%"}else this.gridsStructure.length>b?this.splitAt(b):(this.splitAt(this.gridsStructure.length-1),delete this.gridsStructure[b]);return this}},d.splitAt=function(b,c,d){var e,f=this,g=function(b,c,d,f,h){if(void 0!==b&&(void 0!==e&&clearTimeout(e),b.gridsCells.length>0)){var j=b.id;if(b.id=b.settings.nestedIn+"-"+b.parent().id+"-"+c+d+"-"+Date.now(),b.id=b.id.replace(f,h),a(b.el).attr("id",b.id),void 0!==b.gridsColumns)for(i=0;i<b.gridsColumns.length;i++)if("object"==typeof b.gridsCells[i]){var k=b.gridsCells[i].length;if(k>=0)for(iy=0;iy<k;iy++)if(void 0!==b.gridsCells[i]&&void 0!==b.gridsCells[i][iy]){var l=b.gridsCells[i][iy].data("grid");"function"==typeof b.settings.callAfterMove&&b.settings.callAfterMove(j+""+i+iy,b.id+""+i+iy,b,i,iy,i,iy),g(l,i,iy,f,h),"function"==typeof b.settings.callFinaliseMove&&(e=setTimeout(function(){b.settings.callFinaliseMove()}))}}}};if(void 0!==c){if(void 0!==d)return f.gridsCells[b][c].addClass(f.settings.hasChildrenClass),f.splitCellInColumn(f.gridsCells[b][c],b,c);if(c+1==f.gridsStructure[b].length)f.gridsStructure[b][c+1]=null,f.addCell(b,c+1);else{var h=[],j={},k=[];j.c=f.metaAt[b].c,a.each(f.gridsCells[b],function(a,d){if(a>=c+1){h[a+1]=f.gridsCells[b][a],j[a+1]=f.metaAt[b][a],k[a+1]=f.gridsStructure[b][a],h[a+1].data("cell",'{"x":'+parseInt(b)+',"y":'+parseInt(a+1)+"}"),"function"==typeof f.settings.callAfterMove&&f.settings.callAfterMove(f.id+""+b+a,f.id+""+b+(a+1),f,b,a+1,b,a);var e=h[a+1].data("grid");if(void 0!==e){e.settings.parentsGrid=f,e.settings.parentsX=parseInt(b),e.settings.parentsY=parseInt(a+1);g(e,b,a+1,e.id+"-"+b+a,e.id+"-"+b+(a+1))}}else h[a]=f.gridsCells[b][a],j[a]=f.metaAt[b][a],k[a]=f.gridsStructure[b][a]}),f.gridsCells[b]=h,f.metaAt[b]=j,f.gridsStructure[b]=k,f.gridsStructure[b][c+1]=null,f.addCell(b,c+1),"function"==typeof f.settings.callFinaliseMove&&f.settings.callFinaliseMove()}var l=f.gridsCells[b][c],m=f.gridsCells[b][c+1];f.gridsCells[b].length;if(void 0!==l&&f.buildingGrid!==!0&&"half"==f.settings.splitMethodH){var n=f.metaAt[b][c].h?parseFloat(f.metaAt[b][c].h):100,o=f.halfOf(l,m,n,"h");f.resizeCell(b,c,o),f.resizeCell(b,c+1,o)}else{var o=this.halfOf(l,m,0,"h",b);a.each(this.gridsCells[b],function(a,c){f.resizeCell(b,a,o)})}}else{if(b+1==f.gridsStructure.length)f.gridsStructure[b+1]=null,f.addColumn(b+1);else{var h=[],j={},p=[],k=[];a.each(f.gridsColumns,function(a,d){if(a>=b+1)for(h[a+1]=f.gridsColumns[a],j[a+1]=f.metaAt[a],p[a+1]=f.gridsCells[a],k[a+1]=f.gridsStructure[a],c=0;c<p[a+1].length;c++)p[a+1][c].data("cell",'{"x":'+parseInt(a+1)+',"y":'+parseInt(c)+"}"),"function"==typeof f.settings.callAfterMove&&f.settings.callAfterMove(f.id+""+a+c,f.id+""+(a+1)+c,f,a+1,c,a,c);else h[a]=f.gridsColumns[a],j[a]=f.metaAt[a],p[a]=f.gridsCells[a],k[a]=f.gridsStructure[a]}),f.gridsColumns=h,f.metaAt=j,f.gridsCells=p,f.gridsStructure=k,f.gridsStructure[b+1]=null,f.addColumn(b+1),"function"==typeof f.settings.callFinaliseMove&&f.settings.callFinaliseMove()}var l=f.gridsColumns[b],m=f.gridsColumns[b+1];if(void 0!==f.metaAt[b].c)var q=parseFloat(f.metaAt[b].c.w?f.metaAt[b].c.w:100);else var q=100;if("half"==f.settings.splitMethodV)var r=f.halfOf(l,m,q,"w");else var r=f.halfOf(l,m,q,"w",1);f.resizeColumn(b,r),f.resizeColumn(b+1,r),f.gridsStructure[b+1][0]=null,f.addCell(b+1,0)}return f},d.splitCellInColumn=function(b,c,d,e){var f=this.returnContent(b);if(void 0!==this.metaAt[c][d])var g=this.metaAt[c][d];return b.attr("id",(""!==this.settings.nestedIn?this.settings.nestedIn+"-"+this.id:this.id)+"-"+c+d+Date.now()).css(this.settings.hideBorder).off("click").gridSplit({parentsGrid:this,parentsX:c,parentsY:d,splitCellInColumn:!0,splitMethodH:this.settings.splitMethodH,splitMethodV:this.settings.splitMethodV,horizMin:this.settings.horizMin,vertMin:this.settings.vertMin,callFocusLoad:this.settings.callFocusLoad,callResetGrid:null,callAfterMove:this.settings.callAfterMove,callFinaliseMove:this.settings.callFinaliseMove,callSetFocus:this.settings.callSetFocus,callSetHash:this.settings.callSetHash,callAfterResize:this.settings.callAfterResize,callBeforeDestroy:this.settings.callBeforeDestroy,nestedIn:""!==this.settings.nestedIn?this.settings.nestedIn+"-"+this.id:this.id,data:void 0!==e?e:"",resizable:this.settings.resizable}),this.gridsStructure[c][d],this.gridsStructure[c][d]={},this.gridsStructure[c][d]=b.data("grid").gridsStructure,void 0===this.metaAt[c]&&(this.metaAt[c]={},this.metaAt[c].c={}),void 0!==f&&a(f).length&&b.data("grid").gridsCells[0][0].addClass(this.settings.hasContentClass).append(f),this.metaAt[c][d]=b.data("grid").metaAt,g.h="100%",b.data("grid").setMetaAt(0,0,g),b.data("grid")},d.delCell=function(b,c){var d=this,e=!1,f=[],g={},h=[];if(void 0!==d.gridsColumns[b]&&void 0!==d.gridsCells[b][c])if(d.gridsColumns.length>0)if(d.gridsCells[b].length>1){var i=d.gridsCells[b][c];if(a("#h1-"+i.data("widgetID")).remove(),a("#h2-"+i.data("widgetID")).remove(),a(window).off("resize.grid."+a(this.gridsCells[b][c]).data("widgetID")),g.c=d.metaAt[b].c,a.each(this.gridsCells[b],function(i,j){if(i>c){f[i-1]=d.gridsCells[b][i],g[i-1]=d.metaAt[b][i],h[i-1]=d.gridsStructure[b][i],f[i-1].data("cell",'{"x":'+parseInt(b)+',"y":'+parseInt(i-1)+"}");var k=f[i-1].data("grid");void 0!==k&&(k.settings.parentsGrid=d,k.settings.parentsX=parseInt(b),k.settings.parentsY=parseInt(i-1)),"function"==typeof d.settings.callAfterMove&&d.settings.callAfterMove(d.id+""+b+i,d.id+""+b+(i-1),d,b,i-1,b,i),void 0!==f[i-1]?a(window).trigger("resize.grid."+a(f[i-1]).data("widgetID")):d.delCell(b,i-1)}else if(i!=c)f[i]=d.gridsCells[b][i],g[i]=d.metaAt[b][i],h[i]=d.gridsStructure[b][i];else if(i-1>=0&&"half"==d.settings.splitMethodH){var l=parseFloat(d.metaAt[b][i].h)+parseFloat(d.metaAt[b][i-1].h)+"%";d.metaAt[b][i-1].h=l,d.gridsCells[b][i-1].css("height",l)}else(i-1<0||"half"!==d.settings.splitMethodH)&&(e=!0)}),d.gridsCells[b]=f,d.metaAt[b]=g,d.gridsStructure[b]=h,d!==d.parent()){var j=JSON.parse(d.$el.data("cell")),k=d.parent().metaAt[j.x][j.y].h;d.parent().metaAt[j.x][j.y]=d.metaAt,d.parent().metaAt[j.x][j.y].h=k,d.parent().gridsStructure[j.x][j.y]=d.gridsStructure}"function"==typeof d.settings.callFinaliseMove&&d.settings.callFinaliseMove(),a(i).remove(),e&&d.forcePerHeight(b)}else d.delColumn(b);else d.delColumn(b);return d},d.delColumn=function(b){var c=this,d=!1,e=[],f={},g=[],h=[],i=c.gridsColumns[b];if(void 0!==c.gridsColumns[b]){if(a.each(c.gridsColumns,function(i,j){if(i>b){for(e[i-1]=c.gridsCells[i],f[i-1]=c.metaAt[i],g[i-1]=c.gridsStructure[i],h[i-1]=c.gridsColumns[i],y=0;y<e[i-1].length;y++)void 0!==e[i-1][y]&&(e[i-1][y].data("cell",'{"x":'+parseInt(i-1)+',"y":'+parseInt(y)+"}"),"function"==typeof c.settings.callAfterMove&&c.settings.callAfterMove(c.id+""+i+y,c.id+""+(i-1)+y,c,i-1,y,i,y));void 0!==e[i-1]?a(window).trigger("resize.grid."+a(e[i-1]).data("widgetID")):c.delColumn(i-1)}else if(i!=b){if(e[i]=c.gridsCells[i],f[i]=c.metaAt[i],g[i]=c.gridsStructure[i],h[i]=c.gridsColumns[i],"function"==typeof c.settings.callAfterMove)for(y=0;y<e[i].length;y++)c.settings.callAfterMove(c.id+""+i+y,c.id+""+i+y,c,i,y,i,y)}else if(i-1>=0&&"half"==c.settings.splitMethodV){var k=parseFloat(c.metaAt[i].c.w)+parseFloat(c.metaAt[i-1].c.w)+"%";c.metaAt[i-1].c.w=k,c.gridsColumns[i-1].css("width",k)}else(i-1<0||"half"!==c.settings.splitMethodV)&&(d=!0)}),a(i).remove(),c.gridsCells=e,c.metaAt=f,c.gridsStructure=g,c.gridsColumns=h,c!==c.parent()){var j=JSON.parse(c.$el.data("cell")),k=c.parent().metaAt[j.x][j.y].h;c.parent().metaAt[j.x][j.y]=c.metaAt,c.parent().metaAt[j.x][j.y].h=k,c.parent().gridsStructure[j.x][j.y]=c.gridsStructure}if(0==e.length&&void 0!==c.$el.data("cell")){var j=JSON.parse(c.$el.data("cell"));isNaN(j.x)||isNaN(j.y)||void 0!==c.parent().gridsCells[j.x]&&void 0!==c.parent().gridsCells[j.x][j.y]&&c.parent().delAt(j.x,j.y)}d&&c.forcePerWidth(),"function"==typeof c.settings.callFinaliseMove&&c.settings.callFinaliseMove()}return c},d.delAt=function(a,b){return void 0===b||null==b?this.delColumn(a):this.delCell(a,b)},d.addRail=function(b,c){var d=this,e=void 0!==c?d.gridsCells[b][c]:d.gridsColumns[b];if(!e.hasClass(this.settings.resizableClass)){if(e.addClass(this.settings.resizableClass),"column"==a(e).data("type")){if(0!==b&&"0"!==b){var f=(this.settings.gridColumnClass,this.settings.vertRail),g=f.clone();g.appendTo(e),g.on("mouseenter",function(){var b=a(this).closest("."+d.settings.gridColumnClass).prevAll("."+d.settings.gridColumnClass).length;void 0!==d.gridsColumns[b]&&0!=b||g.remove()}).draggable({axis:"x",containment:e.parent(),start:function(b,c){var e=a(this).closest("."+d.settings.gridColumnClass).prevAll("."+d.settings.gridColumnClass).length;if("function"==typeof d.settings.callSetFocus&&d.settings.callSetFocus(JSON.parse(a(d.gridsCells[e-1][0]).data("cell")),d),void 0!==d.gridsColumns[e]&&0!==e){g.data("x",e);d.gridsColumns[e-1];g.origRight=d.gridsColumns[e].offset().left-d.$el.offset().left,g.origLeft=d.gridsColumns[e-1].offset().left-d.$el.offset().left,g.origWidth=g.origRight-g.origLeft,a(this).addClass(d.settings.draggingClass)}else g.remove()},stop:function(){var c=a(this).offset().left,e=c-g.origWidth-d.$el.offset().left,f=e+g.origWidth-g.origLeft,h=d.perOfWidth(f);d.gridsColumns[a(this).data("x")-1].css("width",h);var i=d.gridsColumns.length-a(this).data("x"),j=(f-g.origWidth)/i;if(i>0){for(b=a(this).data("x");b<d.gridsColumns.length;b++){var k=d.gridsColumns[b].outerWidth(),l=k-j;d.gridsColumns[b].css("width",d.perOfWidth(l))}d.forcePerWidth()}a(this).css("left","auto"),"function"==typeof d.settings.callSetHash&&d.settings.callSetHash()}})}}else if(0!==c&&"0"!==c){var f=(this.settings.gridCellClass,this.settings.horizRail),g=f.clone();g.appendTo(e);var d=this;g.on("mouseenter",function(){var b=a(this).closest("."+d.settings.gridCellClass).prevAll("."+d.settings.gridCellClass).length,c=a(this).closest("."+d.settings.gridColumnClass).prevAll("."+d.settings.gridColumnClass).length;void 0!==d.gridsCells[c][b]&&0!=b||g.remove()}).draggable({containment:e.parent(),axis:"y",start:function(b,c){var e=a(this).closest("."+d.settings.gridCellClass).prevAll("."+d.settings.gridCellClass).length,f=a(this).closest("."+d.settings.gridColumnClass).prevAll("."+d.settings.gridColumnClass).length;"function"==typeof d.settings.callSetFocus&&d.settings.callSetFocus(JSON.parse(a(d.gridsCells[f][e-1]).data("cell")),d),void 0!==d.gridsCells[f][e]&&0!==e?(g.data("x",f),g.data("y",e),a(this).addClass(d.settings.draggingClass)):g.remove()},stop:function(b,c){var e=c.position.top-c.originalPosition.top,f=a(this).data("y"),g=a(this).data("x"),h=(a(this).offset().top,d.gridsCells[g][f-1].outerHeight()+e),i=d.perOfHeight(h);d.resizeCell(g,f-1,i),d.gridsCells[g][f-1].css("height",i),h=d.gridsCells[g][f].outerHeight()-e,i=d.perOfHeight(h),d.resizeCell(g,f,i),d.gridsCells[g][f].css("height",i),a(this).css("top","auto"),d.forcePerHeight(g),"function"==typeof d.settings.callSetHash&&d.settings.callSetHash()}})}a(window).trigger("resize.grid")}},d.handleClick=function(b,c){var d=this;"cell"===c&&"function"==typeof d.settings.callSetFocus&&d.settings.callSetFocus(JSON.parse(a(b).data("cell")),d)},d.addControls=function(b,c){var d=this,e=void 0!==c?d.gridsCells[b][c]:d.gridsColumns[b];if("column"==a(e).data("type")){0!==b&&1==this.settings.resizable&&this.addRail(b,c)}else{0!==c&&1==this.settings.resizable&&this.addRail(b,c),e.on("click",function(){d.handleClick(this,"cell")})}},d.halfOf=function(b,c,d,e,f){if("w"==e)if(void 0!==f)var g=this.perOfWidthEls();else{var g=parseFloat(d/2)+"%";a(b).css({width:g,float:"left"}),a(c).css({width:g,float:"left"})}else if("h"==e)if(void 0!==f)var g=this.perOfHeightEls(f);else{var g=parseFloat(d/2)+"%";a(b).css({height:g}),a(c).css({height:g})}return g},d.perOfWidth=function(a){return 100/this.$el.width()*a+"%"},d.perOfWidthEls=function(){var b=this,c=b.gridsColumns.length,d=100/c+"%";return a.each(b.gridsColumns,function(a,c){c.css({width:d,float:"left"}),b.resizeColumn(a,d)}),d},d.perOfHeight=function(a){return 100/this.$el.outerHeight()*a+"%"},d.perOfHeightEls=function(b){var c=this,d=c.gridsCells[b].length,e=100/d+"%";return a.each(c.gridsCells[b],function(a,d){d.css({height:e}),c.resizeCell(b,a,e)}),e},d.resizeColumn=function(a,b){void 0===this.metaAt&&(this.metaAt={}),void 0===this.metaAt[a]&&(this.metaAt[a]={},this.metaAt[a].c={});var c={w:b};this.setMetaAt(a,null,c);var d=parseFloat(this.$el.outerWidth()/100*parseFloat(b));this.gridsColumns[a].data("trueWidth",d),"function"==typeof this.settings.callAfterResize&&void 0!==this.gridsColumns[a]&&void 0!==this.gridsCells[a][0]&&this.settings.callAfterResize(this.gridsCells[a][0],this,this.gridsColumns[a].data("trueWidth"),this.gridsCells[a][0].data("trueHeight"))},d.resizeCell=function(a,b,c){void 0===this.metaAt[a]&&(this.metaAt[a]={},this.metaAt[a].c={}),void 0===this.metaAt[a][b]&&(this.metaAt[a][b]={});var d={h:c};this.setMetaAt(a,b,d);var e=parseFloat(this.gridsColumns[a].outerHeight()/100*parseFloat(c));this.gridsCells[a][b].data("trueHeight",e),"function"==typeof this.settings.callAfterResize&&void 0!==this.gridsColumns[a]&&void 0!==this.gridsCells[a][b]&&this.settings.callAfterResize(this.gridsCells[a][b],this,this.gridsColumns[a].data("trueWidth"),this.gridsCells[a][b].data("trueHeight"))},d.equalPers=function(a,b){var c=a.length,d=0,e=100;for(min=0;c--;)min=0==b?this.settings.vertMin:this.settings.horizMin,a[c]<min&&(a[c]=min),d+=a[c];for(x=0;x<a.length;x++)a[x]=e/d*a[x];return a},d.forcePerWidth=function(b){var c=[],d=this;if(void 0===b||0==b)a.each(this.gridsColumns,function(b,e){var f=parseFloat(d.perOfWidth(a(e).width()));c.push(f)});else{var e=d.countKeys(this.gridCells),f=parseFloat(100/e)+"%";a.each(this.gridCells,function(a,b){c.push(f)})}var c=d.equalPers(c,0);return a.each(this.gridsColumns,function(b,e){a(e).css({width:c[b]+"%"}),d.resizeColumn(b,c[b]+"%")}),d},d.forcePerHeight=function(b,c){var d=[],e=this;if(void 0!==this.gridsColumns[b]){if(void 0===c||0==c)a.each(e.gridsCells[b],function(b,c){var f=Math.round(parseFloat(e.perOfHeight(a(c).outerHeight())));d.push(f)});else{var f=e.countKeys(e.gridsCells[b]),g=100/f;a.each(e.gridsCells[b],function(a,b){d.push(g)})}var d=e.equalPers(d,1);a.each(e.gridsCells[b],function(c,f){a(f).css({height:d[c]+"%"}),e.resizeCell(b,c,d[c]+"%")})}return e},d.evenAll=function(){var b=this,c=this.metaAt,d=b.countKeys(c);a.each(c,function(e,f){if(!isNaN(e)){var g=100/d,h=b.countKeys(f);c[e].c.w=g+"%","function"==typeof b.settings.callAfterResize&&b.settings.callAfterResize(b.gridsCells[e][0],b,b.gridsColumns[e].data("trueWidth"),b.gridsCells[e][0].data("trueHeight")),h>0?a.each(f,function(d,f){if(!isNaN(d)){var g=100/h;if(c[e][d].h=g+"%","function"==typeof b.settings.callAfterResize&&b.settings.callAfterResize(b.gridsCells[e][d],b,b.gridsColumns[e].data("trueWidth"),b.gridsCells[e][d].data("trueHeight")),a(window).trigger("resize.grid."+a(b.gridsCells[e][d]).data("widgetID")),"object"==typeof f[0]){b.gridsCells[e][d].data("grid").evenAll()}}}):c[e].c.w="100%"}}),b.setMeta(c),b.parent()===b&&"function"==typeof b.settings.callSetHash&&b.settings.callSetHash()},d.setMetaAt=function(b,c,d){var e=this;void 0===e.metaAt[b]&&(e.metaAt[b]={},e.metaAt[b].c={}),null===c?e.metaAt[b].c=a.extend({},e.metaAt[b].c,d):(void 0===e.metaAt[b][c]&&(e.metaAt[b][c]={}),e.metaAt[b][c]=a.extend({},e.metaAt[b][c],d)),a(window).trigger("resize.grid")},d.setMetaAllCells=function(b){var c=this;a.each(d.gridsCells,function(d,e){a.each(e,function(a,e){void 0!==e.data("grid")?(e.data("grid").setMetaAllCells(b),c.setMetaAt(d,null,b)):(c.setMetaAt(d,null,b),c.setMetaAt(d,a,b))})})},d.setProperty=function(b,c){var d=this;if(b){d.settings[b]=c;var e=d.metaAt;d.countKeys(e);a.each(e,function(e,f){if(!isNaN(e)){d.countKeys(f)>0&&a.each(f,function(a,f){if(!isNaN(a)&&"object"==typeof f[0]){d.gridsCells[e][a].data("grid").setProperty(b,c)}})}})}},d.returnProperty=function(a){return this.settings[a]},d.return1stGrid=function(){var a=this;if(a.parent()===a)return a;a=a.parent().return1stGrid()},d.return1stCell=function(){var a=this;return a.gridsCells[0][0].hasClass(a.settings.hasChildrenClass)?a.gridsCells[0][0].data("grid").return1stCell():a.gridsCells[0][0]},d.returnLXY=function(a,b,c){var d=this;if(void 0===c?c=b+""+a+"-":c+=b+""+a+"-",d!==d.parent()){var e=d.settings.parentsGrid,f=d.settings.parentsX,g=d.settings.parentsY;if(void 0!==f)return e.returnLXY(f,g,c)}return c},d.returnLongXY=function(a,b){return this.returnLXY(a,b).split("").reverse().join("").replace(/(^[-\s]+)|([-\s]+$)/g,"")},d.returnContent=function(b){var c=b.children();if(1==c.length){if(0==c.hasClass("horizrail"))var d=c}else if(2==c.length)if(0==a(c[0]).hasClass("horizrail"))var d=a(c[0]);else var d=a(c[1]);return a(d).parents("html").length&&(d=a(d).detach()),a(d)},d.returnStructure=function(){return JSON.stringify(this.gridsStructure)},d.returnMeta=function(){return JSON.stringify(this.metaAt)},d.returnCells=function(){return this.gridsCells},d.countKeys=function(b){var c=0;return a.each(b,function(a,b){isNaN(a)||c++}),c},d.parent=function(){return""===this.settings.parentsGrid?this:this.settings.parentsGrid},d.dontDestroy=function(a){return"function"==typeof this.settings.callBeforeDestroy&&this.settings.callBeforeDestroy(this,1),this.$el},d.destroy=function(a){return"function"==typeof this.settings.callBeforeDestroy&&this.settings.callBeforeDestroy(this),this.$el.empty().removeData("grid"),this.$el};d.init(b,c)}});